{"data":{"site":{"siteMetadata":{"title":"jason.log","author":"Jaesung Lee","siteUrl":"https://jason0853.github.io","comment":{"disqusShortName":"","utterances":"jason0853/gatsby-blog"},"sponsor":{"buyMeACoffeeId":"HFzVClS"}}},"markdownRemark":{"id":"b05882aa-8168-51b9-b224-4cee031ece38","excerpt":"지금까지 회사에서의 업무는 DevOps Engineer가 자동화 시켜놓은 시스템 안에 프론트 관련 리소스를 저장소에 옮기는 것이 업무의 마침표였다. 하지만 난 업무 영역을 좀 더 확장시키고 싶다.\n자신이 짠 코드는 직접 서버에 배포하고 관리해야한다는게 나의 생각이다. Nginx란?위키백관에서 Nginx를 다음과 같이 소개한다.웹 서버 소프트웨어로, 가벼움과 높은 성능을 목표로 한다. 웹 서버, 리버스 프록시 및 메일 프록시 기능을 가진다.Apache…","html":"<p>지금까지 회사에서의 업무는 DevOps Engineer가 자동화 시켜놓은 시스템 안에 프론트 관련 리소스를 저장소에 옮기는 것이 업무의 마침표였다. 하지만 난 업무 영역을 좀 더 확장시키고 싶다.\n<strong>자신이 짠 코드는 직접 서버에 배포하고 관리해야한다는게</strong> 나의 생각이다.</p>\n<h2 id=\"i-classdevicon-nginx-original-colored-stylefont-size-13remi-nginx란\"><a href=\"#i-classdevicon-nginx-original-colored-stylefont-size-13remi-nginx%EB%9E%80\" aria-label=\"i classdevicon nginx original colored stylefont size 13remi nginx란 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><i class=\"devicon-nginx-original colored\" style=\"font-size: 1.3rem;\"></i> Nginx란?</h2>\n<p><a href=\"https://ko.wikipedia.org/wiki/Nginx\">위키백관</a>에서 <strong>Nginx</strong>를 다음과 같이 소개한다.</p>\n<blockquote>\n<p>웹 서버 소프트웨어로, 가벼움과 높은 성능을 목표로 한다. 웹 서버, 리버스 프록시 및 메일 프록시 기능을 가진다.</p>\n</blockquote>\n<p><strong>Apache</strong>라는 유명한 웹서버가 있지만 대용량 요청을 처리하는데 있어서 웹서버로서의 한계를 드러냈다. 그리하여 등장한게 <strong>Nginx</strong>이다. <strong>Nginx</strong>는 기본적으로 Event-Driven 방식 구조를 가지고 있으며 비동기 방식으로 프로세스 내부에서 효율적으로 작업들을 처리한다.</p>\n<h3 id=\"설치\"><a href=\"#%EC%84%A4%EC%B9%98\" aria-label=\"설치 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>설치</h3>\n<p>맥OS 기준으로 작성하겠다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ brew <span class=\"token function\">install</span> nginx\n$ nginx -v\n$ nginx\n$ nginx -s reload\n$ nginx -s stop</code></pre></div>\n<ul>\n<li><code class=\"language-text\">Homebrew</code>를 통하여 <code class=\"language-text\">Nginx</code>를 설치한다.</li>\n<li><code class=\"language-text\">nginx -v</code> - nginx 버전 확인</li>\n<li><code class=\"language-text\">nginx</code> - 서버 시작</li>\n<li><code class=\"language-text\">nginx -s reload</code> - 서버 재시작</li>\n<li><code class=\"language-text\">nginx -s stop</code> - 서버 중지</li>\n</ul>\n<p>서버를 시작하고 나서 <a href=\"http://localhost:8080/\">localhost:8080</a>을 접속하면 아래와 같은 화면이 나올것이다.</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/cb7363bba4fdca75f286ab2b4b935f4b/d67c3/nginx-basic-usage-with-caching-and-load-balancing-1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 60.84840055632823%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAABHUlEQVQoz7WS70+CQBzG76/IMAmjdK61Obde9Be61NlagvxQ+6Nwq8bGIl61Gi/IFyHHeLoDaUlSzerZPnuO43vPlzuONJsyjtsddE7P0DppY//gCJWqiGpNgsDZk9i4ns7tCLWUiiBmsDlRkiEfNrDL1tXlBohuTmBOr2FMZplPZ1DGOrrnffQGQwyGF+j2+ri8UqBqBhRNx0jV3lHZ81g3MGLvNMMEQYlc14XjOPA8D7Z9hzB8xU9E4jhGDl15FEUsxIZlWZjPLdze3MN7eMTz0wKLl5DVUFC6GZIkCT7CxT0IAvi+n/pySVkT3ozXpBUorsv5tOU8tFzrjYtONoWVdc9YD/0ycFv9b+D3Z7bFF/5lKCn+qd+E8Tv8BtZIaUj5W+g0AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"nginx basic usage with caching and load balancing 1\"\n        title=\"\"\n        src=\"/static/cb7363bba4fdca75f286ab2b4b935f4b/b9e4f/nginx-basic-usage-with-caching-and-load-balancing-1.png\"\n        srcset=\"/static/cb7363bba4fdca75f286ab2b4b935f4b/cf440/nginx-basic-usage-with-caching-and-load-balancing-1.png 148w,\n/static/cb7363bba4fdca75f286ab2b4b935f4b/d2d38/nginx-basic-usage-with-caching-and-load-balancing-1.png 295w,\n/static/cb7363bba4fdca75f286ab2b4b935f4b/b9e4f/nginx-basic-usage-with-caching-and-load-balancing-1.png 590w,\n/static/cb7363bba4fdca75f286ab2b4b935f4b/f9b6a/nginx-basic-usage-with-caching-and-load-balancing-1.png 885w,\n/static/cb7363bba4fdca75f286ab2b4b935f4b/2d849/nginx-basic-usage-with-caching-and-load-balancing-1.png 1180w,\n/static/cb7363bba4fdca75f286ab2b4b935f4b/bbefa/nginx-basic-usage-with-caching-and-load-balancing-1.png 1770w,\n/static/cb7363bba4fdca75f286ab2b4b935f4b/d67c3/nginx-basic-usage-with-caching-and-load-balancing-1.png 2876w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n  </span>\n  </a></p>\n<p>접속 성공!👍👍</p>\n<h3 id=\"환경-설정\"><a href=\"#%ED%99%98%EA%B2%BD-%EC%84%A4%EC%A0%95\" aria-label=\"환경 설정 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>환경 설정</h3>\n<p><strong>Nginx</strong>의 모든 환경 설정은 아래 경로 폴더에 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">cd</span> /usr/local/etc/nginx <span class=\"token operator\">&amp;&amp;</span> code <span class=\"token keyword\">.</span></code></pre></div>\n<p><code class=\"language-text\">/usr/local/etc/nginx</code> 위치로 이동해서 VSCode 에서 폴더를 살펴보면 아래와 같은 파일들이 존재한다. 그 중에서도 <em>nginx.conf</em> 파일을 살펴보자.</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3e9336d11af2e7738aa0af516f0a2af5/74a01/nginx-basic-usage-with-caching-and-load-balancing-2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 464px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 168.10344827586206%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAiCAYAAABfqvm9AAAACXBIWXMAABYlAAAWJQFJUiTwAAAE7ElEQVRIx5VV2XLiVhTkC/KSqlTGgAR4ASQQiyQkoQ0EiH0xxsb2bM4kqbxMTSZVeclTKr+QH+6cc20RbDye5KHrCsE99OmzdEqp2DCtHuaLLVbn11isrlGteTgrmSgpLRTL/w8pre7DcmIsV7cYTD9gMLoPeFo0KahFP7KgVBxC+z8h5XcuMJq8RxS/w99/WPj90x3WV5/w9u4z3rz/jJs3nzCk7wejt4R34uwPv4yU4y3Qi2/QHdziz18H+O3jj5gsPmC1/oDzzU+YLe/ghRdw3CUcb4U2IehsEHQvCZsDpPKFKuR8BbnMKb4xXuNVY4LA7SDsThB2xjBbIWwnQq8/Q38wRzea4OS0jhzd4bt5viugijNVONaQ4y/kMmRzjHwtRKNuw6BAlt2F6w1EUMMMBHTdFxfTmRIyWYJU/jc4YRewIBVx5N+gYBMLv0+M5ugTnHZPIOpNBUM/iAlDLJZXmEwvMIgXKCsm5Jz6OGA+p0CqRcipLrRqC/WmB8MIBEudzqZOn80QTXpfb7iCrdnqiM/HJ7Udy1ReBNRQyBzj2+1fkIY/ox9EiMfniOnfo2gK348Fk6pm4yhdhCQrlG5ZpJzdS1lomN/TMG0tIde6qCg6XXbQoH9vkmacEgc7Oa2J1PiinKuAs0u02zHc1zDtXqJgzRBHI4xJnxGx5Op2umPBcDhaYX1xixVN03xxiVrdEWyToHsp3zPMGhPkKsSo1ICitqARK9aqWGoKlsWSLt7fwxQM9yt8WGVvK6o8Hkzhkm7xcIm22xdacaoMZpRgX7uDgMwwwwyrARRiWCobxMrA6VnjEYOneJmheyU0ZIYeMWTNuP/4h5KsPsvoKR4xzJpTyJUAarkJtWoJhqzbWbEhzv2qfpVh/qHKORq/KBjQBlqLyvJ0zOYbMRkcmPVMNOTWeUFDmsvWApLWgUIMK1ThEjFUK5Z4LlNVS2VdtAr3JL9nfQ8YJm2To4CStcBpc0CT0sdktMRoMMOwP8V8co4poUNTc05bfbnaijlWKy2h7UHKGRq9tlzAtrvCsBVhWzrD60YDV6qK62oVb0wDv2gKbPkERxRA3qWsHqZ8TAGPCjVEWQnx+Ueo4RaXrocflmuswx6WXgebeIo7CuqmJXwvUS/S/CYT8mxRZHpQ5CJ6RhcRVXetabi2HCyrNYGNbuLabKHrdGDS9uEtVKu3D8Zup2H+QcPv7DXSzRh2OyLD2sD2h9CdHtzuFKYXoze4n+cx6WnSKstKypf7kBs7276AXO9Dr1uw7QhlqiqzadHGdogZFyGdKYrVxcV4cZbv22aOHC1Zy/TFHPO0hJ0RgnAoTl4UYu0/gHdhouPB+koaW6KUjYYtlgPr1LI6wgLYW3hrB+FINHtIJ5vXywzNGXLU2EazLWaY1z/7BwfkrcML1/X6wg3Z/ViOl0fPu4JskHU2HJEuX+KpYAvgz/wnvCNfHZ3tRvDr60sjIyIb5VRZNz45NbZSfq5QW3FhuMJPgz72ZWboX5M3T2CbpBWlxYx0wxcWwOj1ZiL4hBbHdEYWQS3EciQTc7i+9DEtWF/YqE4V5TS5sglDRr3R3hm/ZXWFFTyfsnSGdHALiXZi6EXwqYrcvNw+97ZZEv2XpJrYaLIcDlNmo6+GyJVt1DRLFEOr2aKZX7KA54vC0R+C5kmP7J4RPRX9a8H/AaxrMoZse0LJAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"nginx basic usage with caching and load balancing 2\"\n        title=\"\"\n        src=\"/static/3e9336d11af2e7738aa0af516f0a2af5/74a01/nginx-basic-usage-with-caching-and-load-balancing-2.png\"\n        srcset=\"/static/3e9336d11af2e7738aa0af516f0a2af5/cf440/nginx-basic-usage-with-caching-and-load-balancing-2.png 148w,\n/static/3e9336d11af2e7738aa0af516f0a2af5/d2d38/nginx-basic-usage-with-caching-and-load-balancing-2.png 295w,\n/static/3e9336d11af2e7738aa0af516f0a2af5/74a01/nginx-basic-usage-with-caching-and-load-balancing-2.png 464w\"\n        sizes=\"(max-width: 464px) 100vw, 464px\"\n      />\n  </span>\n  </a></p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"nginx\"><pre class=\"language-nginx\"><code class=\"language-nginx\"><span class=\"token keyword\">http</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">server</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">        <span class=\"token keyword\">listen</span>       <span class=\"token number\">8080</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">        <span class=\"token keyword\">server_name</span>  localhost<span class=\"token punctuation\">;</span></span>\n        <span class=\"token keyword\">location</span> <span class=\"token operator\">/</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">root</span>   html<span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">            <span class=\"token keyword\">index</span>  <span class=\"token keyword\">index</span><span class=\"token punctuation\">.</span>html <span class=\"token keyword\">index</span><span class=\"token punctuation\">.</span>htm<span class=\"token punctuation\">;</span></span>        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">error_page</span>   <span class=\"token number\">500</span> <span class=\"token number\">502</span> <span class=\"token number\">503</span> <span class=\"token number\">504</span>  <span class=\"token operator\">/</span><span class=\"token number\">50</span>x<span class=\"token punctuation\">.</span>html<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">location</span> <span class=\"token operator\">=</span> <span class=\"token operator\">/</span><span class=\"token number\">50</span>x<span class=\"token punctuation\">.</span>html <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">root</span>   html<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">include</span> servers<span class=\"token operator\">/</span><span class=\"token operator\">*</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>nginx.conf 파일에서 <code class=\"language-text\">server</code> 블럭 안에 있는 몇 줄의 코드를 살펴보겠다.</p>\n<ul>\n<li><code class=\"language-text\">listen 8080</code> - 포트 설정</li>\n<li><code class=\"language-text\">server_name</code> - 서버 네임 설정</li>\n<li>\n<p><code class=\"language-text\">location</code> - 루트 경로 지정</p>\n<ul>\n<li><code class=\"language-text\">root</code> - html 폴더는 상대 경로로서 컴파일 타임에 설정된다. <a href=\"https://stackoverflow.com/questions/39835855/location-of-the-nginx-default-index-html-file-on-mac-os/39836193\">참고</a>\nhtml 폴더는 심볼릭 링크로 연결되어 본래 위치는 <em>/usr/local/var/www</em> 폴더 하위에 index.html 및 50x.html 파일들이 위치해있다.</li>\n</ul>\n</li>\n<li><code class=\"language-text\">include</code> - 필요한 서버 conf 파일 경로 위치 지정</li>\n</ul>\n<h3 id=\"리액트-웹서버-띄우기\"><a href=\"#%EB%A6%AC%EC%95%A1%ED%8A%B8-%EC%9B%B9%EC%84%9C%EB%B2%84-%EB%9D%84%EC%9A%B0%EA%B8%B0\" aria-label=\"리액트 웹서버 띄우기 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>리액트 웹서버 띄우기</h3>\n<p>CRA를 통해 리액트 웹을 빠르게 구현하여 빌드한 소스를 nginx 서버랑 연동시켜보겠다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ npx create-react-app nginx-react-app <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">cd</span> nginx-react-app\n$ <span class=\"token function\">yarn</span> <span class=\"token function\">add</span> react-router-dom</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">//App.js</span>\n<span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> BrowserRouter <span class=\"token keyword\">as</span> Router<span class=\"token punctuation\">,</span> Route<span class=\"token punctuation\">,</span> Link <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react-router-dom'</span>\n<span class=\"token keyword\">import</span> Logo <span class=\"token keyword\">from</span> <span class=\"token string\">'./react-logo.png'</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">Index</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>h2<span class=\"token operator\">></span>Home<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>h2<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>img src<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>Logo<span class=\"token punctuation\">}</span> alt<span class=\"token operator\">=</span><span class=\"token string\">\"logo\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">About</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>h2<span class=\"token operator\">></span>About<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>h2<span class=\"token operator\">></span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">Users</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>h2<span class=\"token operator\">></span>Users<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>h2<span class=\"token operator\">></span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">AppRouter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>Router<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>nav<span class=\"token operator\">></span>\n          <span class=\"token operator\">&lt;</span>ul<span class=\"token operator\">></span>\n            <span class=\"token operator\">&lt;</span>li<span class=\"token operator\">></span>\n              <span class=\"token operator\">&lt;</span>Link to<span class=\"token operator\">=</span><span class=\"token string\">\"/\"</span><span class=\"token operator\">></span>Home<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Link<span class=\"token operator\">></span>\n            <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>li<span class=\"token operator\">></span>\n            <span class=\"token operator\">&lt;</span>li<span class=\"token operator\">></span>\n              <span class=\"token operator\">&lt;</span>Link to<span class=\"token operator\">=</span><span class=\"token string\">\"/about/\"</span><span class=\"token operator\">></span>About<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Link<span class=\"token operator\">></span>\n            <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>li<span class=\"token operator\">></span>\n            <span class=\"token operator\">&lt;</span>li<span class=\"token operator\">></span>\n              <span class=\"token operator\">&lt;</span>Link to<span class=\"token operator\">=</span><span class=\"token string\">\"/users/\"</span><span class=\"token operator\">></span>Users<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Link<span class=\"token operator\">></span>\n            <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>li<span class=\"token operator\">></span>\n          <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>ul<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>nav<span class=\"token operator\">></span>\n\n        <span class=\"token operator\">&lt;</span>Route path<span class=\"token operator\">=</span><span class=\"token string\">\"/\"</span> exact component<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>Index<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>Route path<span class=\"token operator\">=</span><span class=\"token string\">\"/about/\"</span> component<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>About<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>Route path<span class=\"token operator\">=</span><span class=\"token string\">\"/users/\"</span> component<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>Users<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Router<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> AppRouter</code></pre></div>\n<p><code class=\"language-text\">react-router-dom</code> 패키지를 추가하여 간단한 페이지 웹을 구현해보았다. 이제 <code class=\"language-text\">yarn build</code> 명령어를 통해 <code class=\"language-text\">build</code> 폴더를 nginx에서 환경설정한다.</p>\n<p>nginx.conf 파일에서 환경설정을 직접 수정할 수도 있겠지만 필요한 서버마다 conf 파일을 따로 만들어 include 해서 쓰는게 더 나은 방식인 것 같다. 1.10.x 이전 버전까지는 site-available 폴더에 필요한 conf 파일을 만들어 site-enabled 폴더 아래에 심볼링 링크를 생성하여 사용했었다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">ln</span> -s /usr/local/etc/nginx/sites-available/default.conf /usr/local/etc/nginx/sites-enabled</code></pre></div>\n<p>위 명령어는 심볼링 링크 생성하는 예제이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">cd</span> /usr/local/etc/nginx/servers <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">touch</span> default.conf <span class=\"token operator\">&amp;&amp;</span> code <span class=\"token keyword\">.</span></code></pre></div>\n<p>servers 폴더 아래에 default.conf 파일을 다음과 같이 작성한다.</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"nginx\"><pre class=\"language-nginx\"><code class=\"language-nginx\"><span class=\"token keyword\">server</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">listen</span>       <span class=\"token number\">7777</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">server_name</span>  localhost<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">location</span> <span class=\"token operator\">/</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">root</span>   <span class=\"token operator\">/</span>Users<span class=\"token operator\">/</span>jason<span class=\"token operator\">/</span>Desktop<span class=\"token operator\">/</span>nginx<span class=\"token operator\">-</span>react<span class=\"token operator\">-</span>app<span class=\"token operator\">/</span>build<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">index</span>  <span class=\"token keyword\">index</span><span class=\"token punctuation\">.</span>html <span class=\"token keyword\">index</span><span class=\"token punctuation\">.</span>htm<span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">        <span class=\"token keyword\">try_files</span> <span class=\"token variable\">$uri</span> <span class=\"token operator\">/</span><span class=\"token keyword\">index</span><span class=\"token punctuation\">.</span>html<span class=\"token punctuation\">;</span></span>    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li><code class=\"language-text\">try_files</code> - react, vue, angular 라이브러리 및 프레임워크를 이용하여 개발할 경우 대부분 Single Page Application(index.html을 기반으로 내부 모듈을 교체하는 방식)으로 개발을 진행하는게 트렌드이다. 이와 같이 개발을 진행할 경우 빌드한 파일을 \b산출하여 웹서버에서 처리할 수 있도록 설정할 때 404 에러가 일어날 수 있다. 예를 들어 url로 <a href=\"http://localhost:7777/about/\">/about</a>이나 <a href=\"http://localhost:7777/users/\">/users</a>로 직접 접근하거나 리프레쉬 할 겨우 404 에러가 발생한다. 해결책은 요청한 uri를 무시하고 index.html 파일을 제공하는 것이다.</li>\n</ul>\n<p>위와 같이 작성한 뒤 nginx를 재시작하고 <a href=\"http://localhost:7777/\">localhost:7777</a>에 접속해보자.</p>\n<p><img src=\"/nginx-basic-usage-with-caching-and-load-balancing-3-f7ab1c240d7e7dd2ab8c262b626fad7e.gif\"></p>\n<p>위와 같이 나온다면 성공!! 👍👍</p>\n<h3 id=\"캐싱\"><a href=\"#%EC%BA%90%EC%8B%B1\" aria-label=\"캐싱 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>캐싱</h3>\n<p><strong>캐싱</strong>은 정말 중요하다. 사용자가 이미 접속한 사이트의 리소스에 대한 변경이 없다면 브라우저에서 굳이 다시 다운로드 받지 않고 기존에 로컬에 저장되어 있는 리소스에 접근하여 훨씬 더 빠른 사이트에 접속을 할 수 있다.</p>\n<p>기존에 작성했던 default.conf 파일에 <code class=\"language-text\">location</code> 블록 구문을 추가해보자.</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"nginx\"><pre class=\"language-nginx\"><code class=\"language-nginx\"><span class=\"token keyword\">server</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">listen</span>       <span class=\"token number\">7777</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">server_name</span>  localhost<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">location</span> <span class=\"token operator\">/</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">root</span>   <span class=\"token operator\">/</span>Users<span class=\"token operator\">/</span>jason<span class=\"token operator\">/</span>Desktop<span class=\"token operator\">/</span>test<span class=\"token operator\">/</span>build<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">index</span>  <span class=\"token keyword\">index</span><span class=\"token punctuation\">.</span>html <span class=\"token keyword\">index</span><span class=\"token punctuation\">.</span>htm<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">try_files</span> <span class=\"token variable\">$uri</span> <span class=\"token operator\">/</span><span class=\"token keyword\">index</span><span class=\"token punctuation\">.</span>html<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">location</span> <span class=\"token operator\">~</span><span class=\"token operator\">*</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">(</span>ico<span class=\"token operator\">|</span>jpg<span class=\"token operator\">|</span>png<span class=\"token operator\">|</span>gif<span class=\"token operator\">|</span>jpeg<span class=\"token operator\">|</span>swf<span class=\"token operator\">|</span>woff<span class=\"token operator\">|</span>css<span class=\"token operator\">|</span>js<span class=\"token punctuation\">)</span>$ <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">        <span class=\"token keyword\">root</span> <span class=\"token operator\">/</span>Users<span class=\"token operator\">/</span>jason<span class=\"token operator\">/</span>Desktop<span class=\"token operator\">/</span>test<span class=\"token operator\">/</span>build<span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">        <span class=\"token keyword\">expires</span> <span class=\"token number\">1</span>M<span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">        <span class=\"token keyword\">add_header</span> Cache<span class=\"token operator\">-</span>Control <span class=\"token string\">\"public\"</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li><code class=\"language-text\">expires</code> - 만료기한 지정 (초 - s / 일 - d / 월 - M / 년 - y), cache 끄기 <code class=\"language-text\">epoch</code> 로 설정한다.</li>\n<li><code class=\"language-text\">add_header</code> - 헤더 지정.</li>\n</ul>\n<p>하이라이트 된 코드 부분을 추가한 뒤 nginx 서버를 재시작해보자.\n<code class=\"language-text\">nginx -s reload</code></p>\n<p>그리고 나서 개발자 도구를 열어 네트워크 탭쪽을 한번 살펴보자.</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/bf5b9b2db39162fc825da6f212013b58/af071/nginx-basic-usage-with-caching-and-load-balancing-4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 68.16608996539793%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAACiklEQVQ4y21TS0/UUBhtdKEr44IoDCZ0Zvq+bW/f7cz04cAgRoUQFIVEND6ihA1qQlwYNy5d+oeP33ehCgmLM+d+nd7T73E+bavrMJlO0XZzBEEAwzSRFBVmsxnatsWU/yOu61o96+j9/szMcVEUSJIEeZ5D66oKMorg+QGCMERRklizjrZpMZ/PSXCGGV1sWxKiZw3hf9yQWIksy5CmqYImQgnH9VBVE3WhoA843RSGH8Kl57ZtQ/g+LMtWsUWxJwRsT9A9Fy7FPlVmO656V5OBgGuNEAWugvQduMKE55gQtoHxeIzhcEhiroLneYodzycRBz5BxcQM7fHLT7Cn2xjITSwHG1gJF1il80A+gp4sEFIbWFRKqfrEZTFH1CafMue+98zQdo9/4V51hLvJIe7EB7jl7eGmtYMb9i5um1uI45jaUZFArEp3OUOCEL4qlctXZ5oBt0R7+/EYeb0JWcxhyyl0J8WanWCN2ZRKsOXmzwpElBn3yTDOW2GSI/h8mbWT969RFzGywEHCvRutwh0O4BEcfRUpTbAh2xRlCRknCgENUlBGLNKDP8CsHfz8A3n0A9b+GYwXZ1je/oqlJ6dYevYN9xcfUJK31jvy4WSCkMvjQVxMtxe5Inj4/TfyV6dwd44xWH+DFcIyY+MdBvVzbEQB9psK22WKp3mMzVBg4dvIzTFG1wl+OfmMIg4gTF2V6A4f/INN4GnWtBUlGThNMxjcOxYhHl/wFcGHtA1sbItKsexLIKMalqWGwtuTZjkyEuVp8lRZ4NqS+UfXdYxGI2Vg5h4cn9tmogQTyjCioTCzhXqhcc8EjZecd5EXfEKNZ+PykvO5N3NDtsk5O/KdUCYOFfd2uYy/LXu1b8bQwu8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"nginx basic usage with caching and load balancing 4\"\n        title=\"\"\n        src=\"/static/bf5b9b2db39162fc825da6f212013b58/b9e4f/nginx-basic-usage-with-caching-and-load-balancing-4.png\"\n        srcset=\"/static/bf5b9b2db39162fc825da6f212013b58/cf440/nginx-basic-usage-with-caching-and-load-balancing-4.png 148w,\n/static/bf5b9b2db39162fc825da6f212013b58/d2d38/nginx-basic-usage-with-caching-and-load-balancing-4.png 295w,\n/static/bf5b9b2db39162fc825da6f212013b58/b9e4f/nginx-basic-usage-with-caching-and-load-balancing-4.png 590w,\n/static/bf5b9b2db39162fc825da6f212013b58/f9b6a/nginx-basic-usage-with-caching-and-load-balancing-4.png 885w,\n/static/bf5b9b2db39162fc825da6f212013b58/2d849/nginx-basic-usage-with-caching-and-load-balancing-4.png 1180w,\n/static/bf5b9b2db39162fc825da6f212013b58/af071/nginx-basic-usage-with-caching-and-load-balancing-4.png 1734w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n  </span>\n  </a></p>\n<p>빨간 박스 부분을 보면 default.conf에서 설정한 1달 만료기한(60*60*24*30)과 <code class=\"language-text\">public</code>이 <code class=\"language-text\">Cache-Control</code>에 추가되어있다.</p>\n<h3 id=\"로드밸런싱\"><a href=\"#%EB%A1%9C%EB%93%9C%EB%B0%B8%EB%9F%B0%EC%8B%B1\" aria-label=\"로드밸런싱 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>로드밸런싱</h3>\n<p><strong>로드밸런싱</strong>이란 서버를 여러대 두어 분산 처리하는 것을 말한다.\nNginx에는 <code class=\"language-text\">upstream</code>이라는 내장된 모듈을 제공하는데 이 모듈을 사용하여 부하 분산 및 속도 개선을 할 수 있다.</p>\n<p>우선 Koa 프레임워크를 이용하여 간단한 어플리케이션을 작성해보겠다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">mkdir</span> app <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">cd</span> app\n$ <span class=\"token function\">yarn</span> init -y\n$ <span class=\"token function\">yarn</span> <span class=\"token function\">add</span> koa koa-logger\n$ <span class=\"token function\">mkdir</span> src <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">cd</span> src <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">touch</span> index.js</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> Koa <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'koa'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> logger <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'koa-logger'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Koa</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token constant\">PORT</span> <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">PORT</span> <span class=\"token operator\">||</span> <span class=\"token number\">3000</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token function\">logger</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">ctx</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  ctx<span class=\"token punctuation\">.</span>body <span class=\"token operator\">=</span> <span class=\"token string\">'Hello World'</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token constant\">PORT</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`Server is running on port </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token constant\">PORT</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">`</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>index.js를 위와 같이 작성한다.</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"app\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1.0.0\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"main\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"index.js\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"license\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"MIT\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"dependencies\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"koa\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^2.7.0\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"koa-accesslog\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^0.0.2\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"koa-logger\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^3.2.0\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token property\">\"start:1\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"node src\"</span><span class=\"token punctuation\">,</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token property\">\"start:2\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"PORT=3001 node src\"</span><span class=\"token punctuation\">,</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token property\">\"start:3\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"PORT=3002 node src\"</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>package.json 파일을 열어 하이라이트된 부분을 copy&#x26;paste 하자.</p>\n<p>이제 로드밸런싱을 위한 conf를 작성해보자.</p>\n<p>다시 nginx servers 폴더로 이동해서 app.conf 파일 하나를 생성한다. 아래와 같이 작성한다.</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"nginx\"><pre class=\"language-nginx\"><code class=\"language-nginx\"><span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">upstream</span> app <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">  least_conn<span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">server</span>  <span class=\"token number\">127.0</span><span class=\"token number\">.0</span><span class=\"token number\">.1</span><span class=\"token punctuation\">:</span><span class=\"token number\">3000</span> weight<span class=\"token operator\">=</span><span class=\"token number\">5</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">server</span>  <span class=\"token number\">127.0</span><span class=\"token number\">.0</span><span class=\"token number\">.1</span><span class=\"token punctuation\">:</span><span class=\"token number\">3001</span> weight<span class=\"token operator\">=</span><span class=\"token number\">3</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">server</span>  <span class=\"token number\">127.0</span><span class=\"token number\">.0</span><span class=\"token number\">.1</span><span class=\"token punctuation\">:</span><span class=\"token number\">3002</span> weight<span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\"><span class=\"token punctuation\">}</span></span>\n<span class=\"token keyword\">server</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">listen</span> <span class=\"token number\">80</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">location</span> <span class=\"token operator\">/</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">      <span class=\"token keyword\">proxy_pass</span> <span class=\"token keyword\">http</span><span class=\"token punctuation\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>app<span class=\"token punctuation\">;</span></span>  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>\n<p><code class=\"language-text\">upstream</code> - 여러 서버가 순차적으로 일을 할 경우 서비스를 처리하는 서버</p>\n<ul>\n<li><code class=\"language-text\">weight</code> - 서버 가중치 설정</li>\n</ul>\n</li>\n<li><code class=\"language-text\">least_conn</code> - 클라이언트 연결 갯수가 적은 서버로 전달하는 설정</li>\n<li><code class=\"language-text\">proxy_pass</code> - 들어온 요청을 어디로 포워딩 해주는지 지정</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">yarn</span> start:1\n$ <span class=\"token function\">yarn</span> start:2\n$ <span class=\"token function\">yarn</span> start:3\n$ nginx -s reload\n$ ab -n 10 http://127.0.0.1/</code></pre></div>\n<p><code class=\"language-text\">ab</code>는 <strong>Apache HTTP server benchmarking tool</strong>로 웹서버 성능 테스트 도구로 많이 쓰이는 툴이다. <code class=\"language-text\">n</code> 옵션은 총 요청수를 의미한다.</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/cb60bf836084a418c806dbc630f82eb1/8e724/nginx-basic-usage-with-caching-and-load-balancing-5.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 61.04166666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAAB7ElEQVQoz21TyZajMBDjZ6ZZzOoFsyYE6IT0cpj//xiNbEgPhz7oFcSFrJIqwXZfcbnMaOoeXTOg1h2kalBJCykbKL6v7098fv3FbX7gcl2xrBvGy4K2m9D1k6+1HfF+/0TwnD+wrd/o1IA8MVCxhhYWUWKRsIahRpo1GMYNtll4wZWkT2gzIS96jzipEUYaWd4huI0PVN2CnC9lrPyhFDVi0UCkjX93xI6sKAfW2dc0az2JO49i81ODuVuh2glValFF0qvUwlAhSfnsmkRqPZFTU8mRhP2hrvOXvQgdgoEj6Iq+kSSLFGSiUZLIKXw1O6XGzp7gpfiF2PfU/wlDfujgDt44QuikC/fRDteUUmHXLiipLjtInXpfT71+5GFcMQ4rUx5hVA9ZNijymgZbKrJUZ3AdFnytTwz9wi3oYfTAsRvfc+7ryRN83Dast6dPWSUKRmhWvadMOBVF3uI+PbBOG1o5wKRU7cY9zvc+u6d8aWcIkv2hD1VYopYdKnqaOsMPXwS9HesrSiqzvFByG0SyB3cOZB9ZMrnMoAgrSBI2JFMHoThMdx6ajOvEsZQ4Qov3DTjDhyIc85tEHCpEREHjU46VHSuxG78vusfxfFYVJaeURdr6H13CbxxNVANESXX8d8Q/N/+u6Df8A5lrfRUYgBBaAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"nginx basic usage with caching and load balancing 5\"\n        title=\"\"\n        src=\"/static/cb60bf836084a418c806dbc630f82eb1/b9e4f/nginx-basic-usage-with-caching-and-load-balancing-5.png\"\n        srcset=\"/static/cb60bf836084a418c806dbc630f82eb1/cf440/nginx-basic-usage-with-caching-and-load-balancing-5.png 148w,\n/static/cb60bf836084a418c806dbc630f82eb1/d2d38/nginx-basic-usage-with-caching-and-load-balancing-5.png 295w,\n/static/cb60bf836084a418c806dbc630f82eb1/b9e4f/nginx-basic-usage-with-caching-and-load-balancing-5.png 590w,\n/static/cb60bf836084a418c806dbc630f82eb1/f9b6a/nginx-basic-usage-with-caching-and-load-balancing-5.png 885w,\n/static/cb60bf836084a418c806dbc630f82eb1/2d849/nginx-basic-usage-with-caching-and-load-balancing-5.png 1180w,\n/static/cb60bf836084a418c806dbc630f82eb1/bbefa/nginx-basic-usage-with-caching-and-load-balancing-5.png 1770w,\n/static/cb60bf836084a418c806dbc630f82eb1/8e724/nginx-basic-usage-with-caching-and-load-balancing-5.png 2880w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n  </span>\n  </a></p>\n<p>1번 서버에는 가충치를 5, 2번 서버에는 가중치를 3, 3번 서버에는 가중치를 2로 설정했었다. 위와 같이 나온다면 로드밸런싱 성공!! 👍👍</p>","frontmatter":{"title":"Nginx 사용법, 캐싱, 로드밸런싱 알아보기","date":"July 07, 2019"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/nginx/nginx-basic-usage-with-caching-and-load-balancing/","previous":{"fields":{"slug":"/Javascript/code-style-for-performance/"},"frontmatter":{"title":"성능을 높이는 코드 스타일","category":"Javascript"}},"next":null}}